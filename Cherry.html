<!doctype html>
<html lang="ja">
<head>
	<meta charset="UTF-8">
	<title>Cherry Blossom</title>
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script src="http://d3js.org/topojson.v0.min.js"></script>
	<script src="js/jquery-1.8.0.js"></script>  
</head>
<body>
<span id="span1">0</span> 

<style type="background">
  document.body.style.backgroundColor = "black";
</style>
<script>
//定义地图长宽
var height = "780"
var width = "1100"

//定义地图的容器和样式
var svg = d3.select("body").append("svg")
	.attr("width", width)
	.attr("height", height);

//投影函数
d3.json("japan.geojson", function (error, jpn) {

    var projection = d3.geo.mercator()
	    .center([135, 38])
	    .scale(2000)
	    .translate([width / 2, height / 2]);

    var path = d3.geo.path()
	    .projection(projection);


//读取json坐标数据
d3.json("places.json", function(error, places) { 
		
//插入分组元素	
		var location = svg.selectAll(".location")
          .data(places.location)
          .enter()
          .append("g")
          .attr("class","location")
          .attr("transform",function(d){
           
        //计算标注点的位置
         var coor = projection([d.log, d.lat]);
              return "translate("+ coor[0] + "," + coor[1] +")";
          });

       
     //添加提示框
     var tooltip = d3.select("body")
                     .append("div")
                     .attr("class", "tooltip")
                     .style("opacity", 0)
                     .style("position", "absolute");
     
                          
      //插入一个圆
      location.append("circle")
              .attr("r",8)
              .attr("fill", "pink")
              .attr("class","location")      
              .on("mouseover", function(d){
                tooltip.html("City:"+d.name)
                        .style("left", d3.event.pageX - 10+ "px")
                        .style("top", d3.event.pageY + 10 + "px")
                                .style("opacity", 1)
                  d3.select(this).transition()
                                        .duration(150)
                                        .attr("r", 15)
              })
              .on("mouseout", function(){
                tooltip.style("opacity", 0)
                d3.select(this).transition()
                                      .duration(150)
                                      .attr("r", 8)


                }); 
}); 



//创建可以显示温度的数值

var num = 0;  
            var t = setInterval(function(){  
               num++;  
               var span1 = document.getElementById("span1");  
               span1.innerText = num;  
                    if(num==10){  
                        clearInterval(t);  
                    }         
            },100);  

//创建显示提示框用的矩形
       svg.append("rect")
                        .attr("id", "tooltip1")
                        .attr("x", 50)
                        .attr("y",50)
                        .attr("width",140)
                        .attr("height",130)
                        .attr("stroke","black")
                        .attr("fill","none")
                        .style("position", "absolute");

          

//添加标题
    var title = svg.append("text")
                    .attr("x", 180)
                    .attr("y", 37)
                    .style("text-anchor", "middle")
                    .style("font-weight","bold")
                    .style("font-size","20")
                    .attr("fill","pink")
                    .text("The Bloom of 2018 Cherry Blossom")

  
    
    //设置地图格式
    svg.selectAll("path")
	.data(jpn.features)
	.enter()
	.append("path")
	.attr("stroke", "white")
	.attr("fill","#E3F6CE")
	.attr("stroke-width", "0.5")
	.attr("d", path)


    //设置地图鼠标移动效果
	.on("mouseover", function(d, i) {  
                d3.select(this).attr("fill", "#BCF5A9");  
            })  
	.on("mouseout", function(d, i) {  
                d3.select(this).attr("fill", "#E3F6CE");  
            }) 
    .append("title").text(function(d, i) {  
                return d.properties.name; 
            });  



   
    
     
});

</script>
</body>
</html>
